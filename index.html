<!-- =========================
     index.html
     ARSLAN â€” Ventas 3 tiendas (Nube Email/Password + Multi-dispositivo)
     âœ… CDN COMPAT (recomendado para GitHub Pages)
     âœ… Login obligatorio (antes de ver la app)
     âœ… NO guarda contraseÃ±as en el cÃ³digo
========================= -->
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ARSLAN â€” Ventas 3 tiendas</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />

  <!-- Charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>

  <!-- LOGIN (OBLIGATORIO) -->
  <div id="loginView" class="view">
    <div class="card login-card">
      <div class="brand">
        <div class="logo">ğŸ¥</div>
        <div>
          <div class="brand-title">ARSLAN</div>
          <div class="brand-sub">Ventas diarias â€” 3 tiendas Â· Nube segura (Email/Password)</div>
        </div>
      </div>

      <h1>Iniciar sesiÃ³n</h1>
      <p class="muted">ConÃ©ctate a la nube para sincronizar entre dispositivos.</p>

      <div class="grid2">
        <div class="field">
          <label>Email</label>
          <input id="emailInput" class="input" type="email" autocomplete="username" placeholder="tu@email.com" />
        </div>
        <div class="field">
          <label>ContraseÃ±a</label>
          <input id="passInput" class="input" type="password" autocomplete="current-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        </div>
      </div>

      <div class="row gap wrap">
        <button id="btnLogin" class="btn primary">Entrar</button>
        <button id="btnResetPass" class="btn ghost">He olvidado la contraseÃ±a</button>
        <button id="btnThemeLogin" class="btn ghost">ğŸŒ™/â˜€ï¸</button>
      </div>

      <div id="loginMsg" class="msg"></div>

      <div class="hr"></div>

      <details class="hint">
        <summary>ğŸ“Œ Importante</summary>
        <div class="muted small" style="margin-top:8px">
          â€¢ La contraseÃ±a <b>no</b> se guarda en el cÃ³digo. <br/>
          â€¢ Si entras desde un dispositivo vacÃ­o, <b>NO</b> borrarÃ¡ la nube. <br/>
          â€¢ Para borrar registros, se pide confirmaciÃ³n y se borra en <b>todos</b> los dispositivos.
        </div>
      </details>
    </div>
  </div>

  <!-- APP -->
  <div id="appView" class="view hidden app-view">
    <header class="topbar">
      <div class="topbar-left">
        <div class="badge">ğŸ¥ ARSLAN</div>
        <div>
          <div class="title">Ventas 3 tiendas</div>
          <div class="subtitle muted small">San Pablo Â· San Lesmes Â· Santiago</div>
        </div>
      </div>

      <div class="topbar-right">
        <div id="cloudStatus" class="cloud-pill warn">â˜ï¸ Nube: â€¦</div>
        <button id="btnTheme" class="btn ghost">ğŸŒ™/â˜€ï¸</button>
        <button id="btnExport" class="btn ghost">Exportar</button>
        <label class="btn ghost file-label">
          Importar
          <input id="importFile" type="file" accept="application/json" hidden />
        </label>
        <button id="btnLogout" class="btn danger">Salir</button>
      </div>
    </header>

    <!-- Mobile quick mode -->
    <div class="mobile-head" id="mobileHead">
      <div class="row gap wrap">
        <div class="field" style="flex:1">
          <label>Fecha</label>
          <div class="datebar">
            <input id="dateInput" type="date" class="input" />
            <button id="btnToday" class="btn ghost">Hoy</button>
            <button id="btnYesterday" class="btn ghost">Ayer</button>
            <button id="btnTomorrow" class="btn ghost">MaÃ±ana</button>
          </div>
        </div>
      </div>

      <div class="storequick" id="storeQuick">
        <button class="btn storebtn" data-store="san_pablo">San Pablo</button>
        <button class="btn storebtn" data-store="san_lesmes">San Lesmes</button>
        <button class="btn storebtn" data-store="santiago">Santiago</button>
      </div>
    </div>

    <nav class="tabs" id="tabs">
      <button class="tab active" data-tab="tab-entry">Entrada</button>
      <button class="tab" data-tab="tab-day">Resumen</button>
      <button class="tab" data-tab="tab-reports">Reportes</button>
    </nav>

    <main class="container">
      <!-- ENTRADA -->
      <section class="tab-section active" id="tab-entry">
        <div class="card">
          <div class="card-head">
            <h2>Entrada rÃ¡pida</h2>
            <div class="muted small">MÃ³vil: solo lo necesario Â· Escritorio: completo.</div>
          </div>

          <div class="form">
            <div class="row gap wrap desktop-only">
              <div class="field">
                <label>Fecha</label>
                <div class="datebar">
                  <input id="dateInputDesk" type="date" class="input" />
                  <button id="btnTodayDesk" class="btn ghost">Hoy</button>
                  <button id="btnYesterdayDesk" class="btn ghost">Ayer</button>
                  <button id="btnTomorrowDesk" class="btn ghost">MaÃ±ana</button>
                </div>
              </div>

              <div class="field">
                <label>Tienda</label>
                <select id="storeInput" class="input">
                  <option value="san_pablo">San Pablo</option>
                  <option value="san_lesmes">San Lesmes</option>
                  <option value="santiago">Santiago</option>
                </select>
              </div>
            </div>

            <div class="row gap wrap">
              <div class="field">
                <label>Efectivo (â‚¬)</label>
                <input id="cashInput" class="input money" inputmode="decimal" placeholder="0,00" />
              </div>
              <div class="field">
                <label>Tarjeta (â‚¬)</label>
                <input id="cardInput" class="input money" inputmode="decimal" placeholder="0,00" />
              </div>
            </div>

            <div class="row gap wrap">
              <div class="field">
                <label>Gastos (â‚¬)</label>
                <input id="expensesInput" class="input money" inputmode="decimal" placeholder="0,00" />
              </div>
              <div class="field">
                <label>Ticket (â‚¬)</label>
                <input id="ticketInput" class="input money" inputmode="decimal" placeholder="0,00" />
              </div>
            </div>

            <div class="row gap wrap">
              <div class="field">
                <label>Total (Efe + Tar)</label>
                <div id="totalBox" class="input readonly">â€”</div>
              </div>
              <div class="field">
                <label>Diferencia (Ticket âˆ’ Total)</label>
                <div id="diffBox" class="input readonly">â€”</div>
              </div>
            </div>

            <div class="actions sticky-actions">
              <button id="btnSave" class="btn primary">Guardar</button>
              <button id="btnClear" class="btn">Limpiar</button>
              <button id="btnDelete" class="btn danger ghost">Borrar</button>
              <button id="btnGoSummary" class="btn ghost mobile-only">Ver resumen</button>
            </div>

            <div id="saveMsg" class="msg"></div>
          </div>
        </div>
      </section>

      <!-- RESUMEN DEL DÃA -->
      <section class="tab-section" id="tab-day">
        <div class="card">
          <div class="card-head row space wrap">
            <div>
              <h2>Resumen del dÃ­a</h2>
              <div class="muted small">Por tienda + global Â· incluye descuadre Ticket.</div>
            </div>
            <div class="row gap wrap">
              <button id="btnCopyDay" class="btn ghost">Copiar</button>
              <button id="btnWhatsDay" class="btn whatsapp">WhatsApp</button>
            </div>
          </div>

          <div class="summary">
            <div class="pill">
              <div class="k">San Pablo</div>
              <div class="v" id="sumSP">â€”</div>
              <div class="s" id="sumSP2">â€”</div>
            </div>
            <div class="pill">
              <div class="k">San Lesmes</div>
              <div class="v" id="sumSL">â€”</div>
              <div class="s" id="sumSL2">â€”</div>
            </div>
            <div class="pill">
              <div class="k">Santiago</div>
              <div class="v" id="sumSA">â€”</div>
              <div class="s" id="sumSA2">â€”</div>
            </div>

            <div class="hr"></div>

            <div class="pill big">
              <div class="k">GLOBAL (3 tiendas)</div>
              <div class="v" id="sumG">â€”</div>
              <div class="s" id="sumG2">â€”</div>
            </div>

            <div class="hr"></div>
            <div class="muted small" id="dayHint">â€”</div>
            <div id="dayList" class="daylist"></div>
          </div>
        </div>
      </section>

      <!-- REPORTES -->
      <section class="tab-section" id="tab-reports">
        <div class="card">
          <div class="card-head row space wrap">
            <div>
              <h2>Reportes inteligentes</h2>
              <div class="muted small">Semanal / mensual / rango Â· grÃ¡ficos + ranking.</div>
            </div>

            <div class="report-controls">
              <select id="reportType" class="input compact">
                <option value="daily">Diario</option>
                <option value="weekly">Semanal</option>
                <option value="monthly">Mensual</option>
              </select>

              <select id="reportStore" class="input compact">
                <option value="global">Global</option>
                <option value="san_pablo">San Pablo</option>
                <option value="san_lesmes">San Lesmes</option>
                <option value="santiago">Santiago</option>
              </select>

              <input id="rangeFrom" type="date" class="input compact" />
              <input id="rangeTo" type="date" class="input compact" />
              <button id="btnRefresh" class="btn">Actualizar</button>
              <button id="btnWhatsReport" class="btn whatsapp">WhatsApp</button>
              <button id="btnExportCSV" class="btn ghost">CSV</button>
            </div>
          </div>

          <div class="report-grid">
            <div class="kpi"><div class="k">Efectivo</div><div class="v" id="kCash">â€”</div></div>
            <div class="kpi"><div class="k">Tarjeta</div><div class="v" id="kCard">â€”</div></div>
            <div class="kpi"><div class="k">TOTAL</div><div class="v" id="kTotal">â€”</div></div>
            <div class="kpi"><div class="k">Gastos</div><div class="v" id="kExp">â€”</div></div>
            <div class="kpi"><div class="k">Ticket</div><div class="v" id="kTicket">â€”</div></div>
            <div class="kpi"><div class="k">Dif ticket</div><div class="v" id="kDiff">â€”</div></div>
          </div>

          <div class="charts">
            <div class="chart-card">
              <h3>Serie (Total) + media</h3>
              <canvas id="chTotal" height="120"></canvas>
            </div>
            <div class="chart-card">
              <h3>Mix (Efectivo vs Tarjeta)</h3>
              <canvas id="chMix" height="120"></canvas>
            </div>
            <div class="chart-card">
              <h3>Ticket vs Total</h3>
              <canvas id="chTicket" height="120"></canvas>
            </div>
          </div>

          <div class="hr"></div>

          <div class="rank-grid">
            <div class="rank-card">
              <h3>Ranking (tiendas)</h3>
              <div id="rankList" class="ranklist"></div>
              <div class="muted small" id="rankHint">â€”</div>
            </div>
            <div class="rank-card">
              <h3>Porcentajes (global)</h3>
              <div class="rankbox">
                <div class="k">San Pablo</div>
                <div class="v" id="pctSP">â€”</div>
                <div class="s" id="pctSP2">â€”</div>
              </div>
              <div class="rankbox">
                <div class="k">San Lesmes</div>
                <div class="v" id="pctSL">â€”</div>
                <div class="s" id="pctSL2">â€”</div>
              </div>
              <div class="rankbox">
                <div class="k">Santiago</div>
                <div class="v" id="pctSA">â€”</div>
                <div class="s" id="pctSA2">â€”</div>
              </div>
            </div>
          </div>

          <div class="hr"></div>

          <div class="table-wrap">
            <table class="table" id="repTable">
              <thead>
              <tr>
                <th>Periodo</th>
                <th>Efectivo</th>
                <th>Tarjeta</th>
                <th>Total</th>
                <th>Gastos</th>
                <th>Ticket</th>
                <th>Dif ticket</th>
              </tr>
              </thead>
              <tbody></tbody>
            </table>
            <div class="muted small" id="repHint">â€”</div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer muted small">
      Guardado local + sincronizaciÃ³n segura en nube (Email/Password Â· RTDB).
    </footer>

    <button id="btnTop" class="fab-top" title="Subir">â†‘</button>
  </div>

  <!-- Firebase CDN COMPAT (sin modules) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-database-compat.js"></script>

  <script>
    window.__FIREBASE_CONFIG__ = {
      apiKey: "AIzaSyB3sWpb9PVntGP2T83IzilnVK5v_LcaaXg",
      authDomain: "gsttt-82973.firebaseapp.com",
      databaseURL: "https://gsttt-82973-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "gsttt-82973",
      storageBucket: "gsttt-82973.firebasestorage.app",
      messagingSenderId: "29419291414",
      appId: "1:29419291414:web:0970ac92deb39983854637"
    };

    // init once
    try{
      firebase.initializeApp(window.__FIREBASE_CONFIG__);
    }catch(e){
      // ignore "already exists"
    }

    window.__firebase = {
      auth: firebase.auth(),
      db: firebase.database(),
      serverTimestamp: firebase.database.ServerValue.TIMESTAMP
    };
  </script>

  <script src="app.js"></script>
</body>
</html>
