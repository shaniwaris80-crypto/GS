<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ARSLAN ‚Äî Facturaci√≥n Diaria (3 Tiendas)</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>

  <!-- LOGIN -->
  <div id="loginView" class="view">
    <div class="card login-card">
      <div class="brand">
        <div class="logo">ü•ù</div>
        <div>
          <div class="brand-title">ARSLAN</div>
          <div class="brand-sub">Facturaci√≥n diaria ‚Äî 3 tiendas</div>
        </div>
      </div>

      <h1>Entrar</h1>
      <p class="muted">Introduce tu PIN para acceder.</p>

      <div class="row gap wrap">
        <input id="pinInput" inputmode="numeric" maxlength="10" class="input pin" placeholder="PIN" />
        <button id="btnLogin" class="btn primary">Entrar</button>
      </div>

      <div id="loginMsg" class="msg"></div>

      <div class="hr"></div>

      <div class="row space wrap">
        <div class="muted small">Acceso protegido</div>
        <button id="btnThemeLogin" class="btn ghost">üåô/‚òÄÔ∏è</button>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div id="appView" class="view hidden app-view">
    <header class="topbar">
      <div class="topbar-left">
        <div class="badge">ü•ù ARSLAN</div>
        <div>
          <div class="title">Facturaci√≥n Diaria</div>
          <div class="subtitle muted small">San Pablo ¬∑ San Lesmes ¬∑ Santiago</div>
        </div>
      </div>

      <div class="topbar-right">
        <button id="btnTheme" class="btn ghost">üåô/‚òÄÔ∏è</button>
        <button id="btnBackup" class="btn ghost">Exportar JSON</button>
        <label class="btn ghost file-label">
          Importar JSON
          <input id="importFile" type="file" accept="application/json" hidden />
        </label>
        <button id="btnLogout" class="btn danger">Salir</button>
      </div>
    </header>

    <main class="container">
      <!-- Entrada + Resumen -->
      <section class="grid-2">
        <!-- ENTRADA -->
        <div class="card">
          <div class="card-head">
            <h2>Entrada diaria</h2>
            <div class="muted small">Guarda ventas por tienda (efectivo + tarjeta) y el importe del ticket.</div>
          </div>

          <div class="form">
            <div class="row gap wrap">
              <div class="field">
                <label>Fecha</label>
                <input id="dateInput" type="date" class="input" />
              </div>
              <div class="field">
                <label>Tienda</label>
                <select id="storeInput" class="input">
                  <option value="san_pablo">San Pablo</option>
                  <option value="san_lesmes">San Lesmes</option>
                  <option value="santiago">Santiago</option>
                </select>
              </div>
            </div>

            <div class="row gap wrap">
              <div class="field">
                <label>Efectivo (‚Ç¨)</label>
                <input id="cashInput" class="input" inputmode="decimal" placeholder="0,00" />
              </div>
              <div class="field">
                <label>Tarjeta (‚Ç¨)</label>
                <input id="cardInput" class="input" inputmode="decimal" placeholder="0,00" />
              </div>
            </div>

            <div class="row gap wrap">
              <div class="field">
                <label>Importe ticket (‚Ç¨)</label>
                <input id="ticketInput" class="input" inputmode="decimal" placeholder="0,00" />
              </div>
              <div class="field">
                <label>Diferencia (Ticket - Total)</label>
                <div class="input readonly" id="diffBox">‚Äî</div>
              </div>
            </div>

            <div class="actions">
              <button id="btnSave" class="btn primary">Guardar / Actualizar</button>
              <button id="btnClear" class="btn">Limpiar</button>
              <button id="btnDelete" class="btn danger ghost">Borrar</button>
              <button id="btnWhatsAppDay" class="btn whatsapp">WhatsApp (d√≠a)</button>
            </div>

            <div class="hr"></div>

            <div class="card-sub">
              <div class="row space wrap">
                <div>
                  <div class="muted small">Historial del d√≠a (clic para cargar)</div>
                  <div class="muted small" id="dayHint">‚Äî</div>
                </div>
                <button id="btnCopyDay" class="btn ghost">Copiar texto d√≠a</button>
              </div>

              <div id="dayList" class="daylist"></div>
            </div>

            <div id="saveMsg" class="msg"></div>
          </div>
        </div>

        <!-- RESUMEN -->
        <div class="card">
          <div class="card-head">
            <h2>Resumen del d√≠a</h2>
            <div class="muted small">Totales por tienda + global (incluye diferencia por ticket).</div>
          </div>

          <div class="summary">
            <div class="pill">
              <div class="k">San Pablo</div>
              <div class="v" id="sumSP">‚Äî</div>
              <div class="s" id="sumSP2">‚Äî</div>
            </div>
            <div class="pill">
              <div class="k">San Lesmes</div>
              <div class="v" id="sumSL">‚Äî</div>
              <div class="s" id="sumSL2">‚Äî</div>
            </div>
            <div class="pill">
              <div class="k">Santiago</div>
              <div class="v" id="sumSA">‚Äî</div>
              <div class="s" id="sumSA2">‚Äî</div>
            </div>

            <div class="hr"></div>

            <div class="pill big">
              <div class="k">GLOBAL (3 tiendas)</div>
              <div class="v" id="sumGlobal">‚Äî</div>
              <div class="s" id="sumGlobal2">‚Äî</div>
            </div>

            <div class="hr"></div>

            <div class="goals">
              <div class="row gap wrap">
                <div class="field">
                  <label>Objetivo diario (‚Ç¨)</label>
                  <input id="goalDaily" class="input" inputmode="decimal" placeholder="Ej: 3000" />
                </div>
                <div class="field">
                  <label>Objetivo mensual (‚Ç¨)</label>
                  <input id="goalMonthly" class="input" inputmode="decimal" placeholder="Ej: 90000" />
                </div>
              </div>
              <div class="row gap wrap">
                <button id="btnSaveGoals" class="btn">Guardar objetivos</button>
              </div>

              <div class="goalBox">
                <div class="k">Cumplimiento (hoy)</div>
                <div class="v" id="goalTodayPct">‚Äî</div>
                <div class="s" id="goalTodayTxt">‚Äî</div>
              </div>

              <div class="goalBox">
                <div class="k">Cumplimiento (mes actual)</div>
                <div class="v" id="goalMonthPct">‚Äî</div>
                <div class="s" id="goalMonthTxt">‚Äî</div>
              </div>
            </div>

          </div>
        </div>
      </section>

      <!-- REPORTES -->
      <section class="card">
        <div class="card-head row space wrap">
          <div>
            <h2>Reportes & Rendimiento</h2>
            <div class="muted small">Diario / Semanal / Mensual ‚Äî con rango y ranking.</div>
          </div>

          <div class="report-controls">
            <select id="reportType" class="input compact">
              <option value="daily">Diario</option>
              <option value="weekly">Semanal</option>
              <option value="monthly">Mensual</option>
            </select>

            <select id="reportStore" class="input compact">
              <option value="global">Global (3 tiendas)</option>
              <option value="san_pablo">San Pablo</option>
              <option value="san_lesmes">San Lesmes</option>
              <option value="santiago">Santiago</option>
            </select>

            <input id="rangeFrom" type="date" class="input compact" />
            <input id="rangeTo" type="date" class="input compact" />

            <button id="btnRefresh" class="btn">Actualizar</button>
            <button id="btnWhatsAppReport" class="btn whatsapp">WhatsApp (reporte)</button>
            <button id="btnWhatsAppReportFull" class="btn whatsapp ghost">WhatsApp (completo)</button>
            <button id="btnExportCSV" class="btn ghost">Exportar CSV</button>
          </div>
        </div>

        <div class="report-grid">
          <div class="kpi">
            <div class="k">Efectivo</div>
            <div class="v" id="kpiCash">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="k">Tarjeta</div>
            <div class="v" id="kpiCard">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="k">TOTAL</div>
            <div class="v" id="kpiTotal">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="k">Promedio/d√≠a</div>
            <div class="v" id="kpiAvg">‚Äî</div>
          </div>
        </div>

        <div class="charts">
          <div class="chart-card">
            <h3>Serie (Total)</h3>
            <canvas id="chartTotal" height="120"></canvas>
          </div>
          <div class="chart-card">
            <h3>Mix (Efectivo vs Tarjeta)</h3>
            <canvas id="chartMix" height="120"></canvas>
          </div>
        </div>

        <div class="hr"></div>

        <div class="rank-grid">
          <div class="rank-card">
            <h3>Ranking (rango actual)</h3>
            <div id="rankList" class="ranklist"></div>
          </div>
          <div class="rank-card">
            <h3>Mejor / Peor</h3>
            <div class="rankbox">
              <div class="k">Mejor tienda</div>
              <div class="v" id="bestStore">‚Äî</div>
              <div class="s" id="bestStoreTxt">‚Äî</div>
            </div>
            <div class="rankbox">
              <div class="k">Peor tienda</div>
              <div class="v" id="worstStore">‚Äî</div>
              <div class="s" id="worstStoreTxt">‚Äî</div>
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="table-wrap">
          <table class="table" id="reportTable">
            <thead>
              <tr>
                <th>Periodo</th>
                <th>Efectivo</th>
                <th>Tarjeta</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="muted small" id="tableHint"></div>
        </div>
      </section>
    </main>

    <footer class="footer muted small">
      Guardado local (localStorage). Usa exportaci√≥n para copia.
    </footer>
  </div>

  <script src="app.js"></script>
</body>
</html>
